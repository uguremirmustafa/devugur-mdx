---
title: Apollo ve React Kullanarak Fullstack KullanÄ±cÄ± Kimlik DoÄŸrulama Sistemi - Login/Register
summary: Kimlik DoÄŸrulama Sisteminin(Authentication Flow) olmadÄ±ÄŸÄ± bir web uygulamasÄ± hayal etmek neredeyse imkansÄ±z. BazÄ± ÅŸirketler Auth0 gibi hazÄ±r sistemler tercih ederken bazÄ±larÄ± ise in-house Ã§Ã¶zÃ¼mler yaratÄ±yorlar. Bu projede Apollo ve React kullanarak server ve client'Ä±n GraphQL Ã¼zerinden konuÅŸtuÄŸu fullstack bir kimlik doÄŸrulama sistemi hazÄ±rladÄ±m. Sonraki projenizde bu kodu boilerplate olarak kullanabilirsiniz.
publishedAt: '2021-10-08'
images:
  [
    '/images/portfolio/graphql-ile-fullstack-kimlik-doÄŸrulama-sistemi/graphql.png',
    '/images/portfolio/graphql-ile-fullstack-kimlik-doÄŸrulama-sistemi/register.png',
  ]
techStack: ['React', 'Apollo-Server', 'Apollo-Client', 'GraphQL', 'JWT', 'Postgres', 'Chakra-UI']
tags:
  ['react', 'graphql', 'typescript', 'apollo-server-express', 'apollo-client', 'jwt', 'postgres']
locale: tr
alternate: ''
type: project
isPublished: true
selected: true
github: https://github.com/uguremirmustafa/graphql-express-jwt-auth-server
demo: https://express-graphql-jwt-auth.vercel.app
---

![register](./register.png)

Kimlik doÄŸrulama sistemleri, kullanÄ±cÄ±nÄ±n temel bilgilerinin(email, ÅŸifre vb.) alÄ±narak bir veritabanÄ±nda ÅŸifrelenerek saklandÄ±ÄŸÄ± ve kullanÄ±cÄ± uygulamaya giriÅŸ yaparken kullanÄ±cÄ±dan alÄ±nan bilgilerin veritabanÄ±ndakilerle uyuÅŸup uyuÅŸmadÄ±ÄŸÄ±nÄ±n kontrol edildiÄŸi sistemlerdir. AslÄ±nda hepimizin aÅŸina olduÄŸu _giriÅŸ yap/kaydol_ iÅŸleminin arkasÄ±ndaki sistemden bahsediyorum. Bu uygulamada server ve client'Ä±n _GraphQL_ Ã¼zerinden haberleÅŸtiÄŸi bir fullstack kimlik doÄŸrulama sistemi geliÅŸtirdim. Bu projeyi hazÄ±rlarken aÅŸaÄŸÄ±daki teknolojilerden yararlandÄ±m:

- Server tarafÄ±nda
  - [apollo-server-express](https://www.npmjs.com/package/apollo-server-express)
  - [jwt](https://jwt.io/)
  - [typeorm](https://typeorm.io/#/)
  - [typegraphql](https://typegraphql.com/)
  - [ioredis](https://github.com/luin/ioredis)
  - [typescript](https://www.typescriptlang.org/)
- Client tarafÄ±nda
  - [react](https://reactjs.org/)
  - [apollo-client](https://www.apollographql.com/docs/react/)
  - [formik](https://formik.org/)
  - [chakra-ui](https://chakra-ui.com/)
  - [typescript](https://www.typescriptlang.org/)
  - [graphql-code-generator](https://www.graphql-code-generator.com/)

## 1. KullandÄ±ÄŸÄ±m AraÃ§lar ve Tercih Sebeplerim

### apollo-server-express

GraphQL ile server oluÅŸtururken en gÃ¼Ã§lÃ¼ seÃ§enekler arasÄ±nda apollo-server ve apollo-server-express yer alÄ±yor. Apollo'nun kendi sitesinde verdiÄŸi bilgilere gÃ¶re apollo-server'Ä±n arka planÄ±nda da apollo-server-express Ã§alÄ±ÅŸÄ±yor fakat ince ayarlamalar iÃ§in apollo-server-express tavsiye ediliyor. Bu proje bir boilerplate olduÄŸunda geliÅŸtirmelere ve detaylÄ± konfigÃ¼rasyon deÄŸiÅŸikliklerine aÃ§Ä±k olmasÄ±nÄ± istedim ve bu nedenle apollo-server-express'i server olarak tercih ettim.

![graphql](./graphql.png)

### jwt

Daha Ã¶ncesinde buna benzer bir projede session'lar ile Ã§alÄ±ÅŸmÄ±ÅŸtÄ±m. Bu sefer farklÄ± bir deneyim olmasÄ± iÃ§in JWT tercih ettim. Cookie olarak gÃ¶nderdiÄŸim refresh-token ve access-token'larÄ±mÄ± jwt ile imzalayarak gÃ¶nderdim ve kullanÄ±cÄ±dan gelen request'leri de bir adet middleware yardÄ±mÄ± ile authenticated olup olmamasÄ±na gÃ¶re deÄŸerlendirdim.

### typeorm ve typegraphql

Bu iki kÃ¼tÃ¼phanenin birlikte ne denli uyumlu Ã§alÄ±ÅŸtÄ±klarÄ±nÄ± Ben Awad'Ä±n [ÅŸu](https://www.youtube.com/watch?v=25GS0MLT8JU) videosunda gÃ¶rdÃ¼ÄŸÃ¼mden beri vazgeÃ§ilmez araÃ§larÄ±m arasÄ±nda yer alÄ±yorlar. _Typeorm_ Typescript desteÄŸi olan bir ORM, yani veritabanÄ± etkileÅŸim aracÄ±. Onun sayesinde _postgres_ veritabanÄ±m ile iletiÅŸimimi saf SQL sorgularÄ± yazmak yerine daha zarif bir biÃ§imde utility fonksiyonlarÄ± ile yazÄ±yorum.

_typegraphql_ ise Typeorm ile yazmÄ±ÅŸ olduÄŸumuz _entity_ dosyalarÄ±na birer _@Field_ decorator'Ä± ekleyerek ayrÄ±ca type definitionlarÄ± yazmadan kolayca Graphql type'larÄ±mÄ± hazÄ±rlamÄ±ÅŸ oluyorum. Bu iki aracÄ± detaylÄ±ca Ã¶ÄŸrenmek isterseniz Ben Awad'Ä± muhakkak izleyin derim.

```jsx
import { Field, Int, ObjectType } from 'type-graphql';
import { Entity, PrimaryGeneratedColumn, Column, BaseEntity } from 'typeorm';

@ObjectType()
@Entity('users')
export class User extends BaseEntity {
  @Field(() => Int)
  @PrimaryGeneratedColumn()
  id!: number;

  @Field(() => String)
  @Column('text', { unique: true })
  email!: string;

  @Field(() => String)
  @Column('text', { unique: true })
  username!: string;

 @Column('text')
  password!: string;

  @Column('int', { default: 0 })
  tokenVersion: number;
}
```

### ioredis

Redis bu projede bana _rate-limiting_ yaparken yardÄ±mcÄ± oldu. _DDOS ataklarÄ±nÄ±_ Ã¶nlemek adÄ±na kullanÄ±cÄ± ip adresleri ile Redis'te keyler sakladÄ±m. BÃ¶ylece anlÄ±k ciddi bir talep olduÄŸunda ilgili ip adresini belirli bir sÃ¼re engelleme ÅŸansÄ±m oldu. Redis'in ne kadar hÄ±zlÄ± ve bu tarz iÅŸler iÃ§in ne kadar elveriÅŸli olduÄŸunu sizler zaten biliyorsunuz.

### apollo-client

Browser tarafÄ±nda React ile kullanÄ±cÄ± arayÃ¼zÃ¼nÃ¼ oluÅŸturdum. Apollo-client ile uygulamamÄ± sardÄ±m ve server tarafÄ±ndaki verileri GraphQL sorgularÄ± ile kolayca Ã§aÄŸÄ±rabildim.

```jsx
const client = new ApolloClient({
  link: from([tokenRefreshLink, authLink, httpLink]),
  cache: new InMemoryCache({}),
});

ReactDOM.render(
  <ApolloProvider client={client}>
    <App />
  </ApolloProvider>,
  document.getElementById('root')
);
```

### graphql-code-generator

Bu aracÄ±n ne kadar iÅŸe yaradÄ±ÄŸÄ±nÄ± ve vakit kazandÄ±rdÄ±ÄŸÄ±nÄ± anlatmak mÃ¼mkÃ¼n deÄŸil. BilgisayarÄ±nÄ±za kuracaÄŸÄ±nÄ±z bir CLI yardÄ±mÄ± ile sizlere GraphQL sorgularÄ±nÄ±za gÃ¶re custom React hook yapÄ±larÄ± oluÅŸturuyor, hem de tamamen Typescript destekli. Bunun sayesinde artÄ±k apollo-client'Ä±n sunduÄŸu `useQuery` ve `useMutation` nasÄ±l Ã§alÄ±ÅŸÄ±yordu onu dahi unuttum. ğŸ¥³

### formik

Bu vesile ile form oluÅŸturma Ã§ilesini sÄ±rtÄ±mÄ±zdan alan `formik` ve `react-hook-form` kÃ¼tÃ¼phanelerine ve geliÅŸtiricilerine tekrar teÅŸekkÃ¼rlerimi iletiyorum. Bunlar birer harika. Bu projedeki tercihim ise formik'ten yana oldu. GeÃ§erli bir sebebi yok sanÄ±rÄ±m. Yoksa ikisi de harika kÃ¼tÃ¼phaneler. Åuraya da oluÅŸturmuÅŸ olduÄŸum _custom input field_'Ä± bÄ±rakayÄ±m da tam olsun.

```jsx
import { FormControl, FormErrorMessage, FormLabel, Input, Textarea } from '@chakra-ui/react';
import { useField } from 'formik';
import React, { FC, InputHTMLAttributes } from 'react';

type IProps = InputHTMLAttributes<HTMLInputElement | HTMLTextAreaElement> & {
  name: string,
  label: string,
  textarea?: boolean,
};

const InputField: FC<IProps> = ({ label, textarea, size: _, ...props }) => {
  const [field, { error }] = useField(props);
  return (
    <FormControl isInvalid={!!error}>
      <FormLabel htmlFor={field.name}>{label}</FormLabel>
      {!textarea ? (
        <Input {...field} {...props} id={field.name} placeholder={props.placeholder} />
      ) : (
        <Textarea {...field} {...props} id={field.name} placeholder={props.placeholder} />
      )}
      {error ? <FormErrorMessage>{error}</FormErrorMessage> : null}
    </FormControl>
  );
};

export default InputField;
```

### chakra-ui

SÃ¼rekli Material-UI kullanmaktan gÄ±na geldiÄŸi iÃ§in bu projede Chakra-UI tercih ettim. Gayet eÄŸlenceli bir kÃ¼tÃ¼phane olduÄŸunu sÃ¶yleyebilirim. _Tailwind_ seven arkadaÅŸlar bunu da seveceklerdir.

![login](./login.png)

## 2. Sonraki AdÄ±mlar ve Eklenecek Ã–zellikler

Projenin ÅŸu an iÃ§in geliÅŸtirme aÅŸamasÄ±nda olduÄŸunu sÃ¶yleyebilirim. Ã–zellikle TypeORM tarafÄ±nda keÅŸfedilecek birÃ§ok Ã¶zellik var. Hele benim gibi frontend tarafÄ±nÄ±za daha Ã§ok gÃ¼veniyor ve backend'e yeni yeni Ä±sÄ±nÄ±yorsanÄ±z TypeORM'u keÅŸfetmenin heyecanlÄ± bir sÃ¼reÃ§ olduÄŸunu sÃ¶ylemek isterim. Åimdilik kafamda eklemeyi dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼m Ã¶zellikler ve yapÄ±lacaklar listesine ÅŸunlarÄ± sÄ±ralayabiliriz:

- _Global error handler:_ TypeORM hatalarÄ± yakalayacak global bir fonksiyon yazma imkanÄ± tanÄ±yor sanÄ±rÄ±m. YakÄ±nda bunu keÅŸfetmeyi planlÄ±yorum ki her resolver iÃ§in ayrÄ± ayrÄ± error-handling yapmayalÄ±m.
- _Åifre yenileme - forgot password:_ Åimdilik ÅŸifrenizi unuttunuz mu yandÄ±nÄ±z ama yakÄ±nda ÅŸifremi unuttum Ã¶zelliÄŸi geliyor. â³

## 3. SonuÃ§

Bu proje ile JWT kullanarak GraphQL authentication server nasÄ±l kurulur onu Ã¶ÄŸrendim. Buna ek olarak React tarafÄ±nda cookie yÃ¶netimi ve HTTP headers konusunda yeni deneyimler edindim. Bir de Vercel'de environment variable'larÄ±n REACT_APP\_ prefixi ile yazÄ±lmasÄ± gerektiÄŸini yoksa saatlerce boÅŸa vakit harcanabileceÄŸini gÃ¶rmÃ¼ÅŸ oldum. Ä°ÅŸte bunlar hep tecrÃ¼be.

Sonraki projelerde gÃ¶rÃ¼ÅŸmek Ã¼zere. ğŸ¤—
